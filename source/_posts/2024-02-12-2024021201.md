---
title: 【ご報告】OGPのメタタグを出力するようにしました【やっとかよ】
excerpt: サイト構築用のプログラムをblosxomからJekyllに移行した時にOGPのメタタグ出力を実装してなかったのですが、最近「やっぱこれじゃちょっとダメかも…」とか思うようになってきたので、ようやく気合い入れて実装してみました、というお知らせです。
date: 2024/02/12 23:00
layout: post
categories: [weblog]
tags: [site, information, ogp, jekyll]
og:
  image: /images/2024/02/12/ogp-implementation-post_thumbnail.png
---
{% include post_thumbnail.html alt="" %}

こなさんみんばんわ。  
このWebサイトは開設してから15年ほど経ってて、あと1ヶ月くらいで16年目に突入するんですが、記事書きや管理に掛けた時間を足し算した実質的な活動期間は、その1/10くらいな気がします。涙

で、その15年の間にサイトを構築するためのプログラムを[blosxom][]（懐）から[Jekyll][]へと移行してるんですが、その時に「これは後回しでもええかな」とか思って、<abbr title="Open Graph Protocol">OGP</abbr>のメタタグを出力するコードを書いてなかったんですね。当時はもちろん「そのうちやるぞ」と思ってたのですが、その後すっかり忘却の彼方へ…涙

今まではそういうのをあまり重要視してなくて気にも留めてなかったのですが、それがここ最近はFacebookや[Twitter][X][^1]など以外にも色々とSNSサービスが増えてきまして、んでそういった新しいSNSはなるべく早めにアカウントを確保して[^2]URL共有のテストとかをしてみるんですが、まぁOGPが当たり前のように普及してる現在なので、この辺のSNSもURLを投稿したら普通にOGPを読んで、リンク先をうまいこと表示してくれるんですね。

そうやってテストする中で、自分のサイトのURLを共有したものを自分の目で見る機会が増えてきますと、やっぱり気になってくるんですね。「ああ、やっぱりこれでは見る側の目にも留まりにくいだろうな、このままじゃさすがにちょっとダメかも…」とか、次第に感じるようになってきました。

そんな訳で、最近ちょっと時間的な余裕が増えたこともあり、ここは思い立ったが吉日! とばかり、ちゃんと各ページにOGPのメタタグが出力されるようがんばってみました、という次第です。**前置き長いわ!** 涙

{% include ads_inarticle.html slot=4720985151 %}


## どうやって出力してますか?

「がんばった」とか書きましたけど、作業的にはあまり時間が掛かった訳でもないし、たいしたこともしてないですよ。期待せんといてください。涙

まず`og:title`と`og:description`については、元々[Jekyll Archives][archives]プラグインを導入した際に、`title`要素や`<meta name="description" …>`のタグをページに合わせて出し分けるロジックをLiquid Tag化してましたので、そのプラグインにOGPのメタタグを出力する機能を付け足しました。具体的な実装コードはここでは省略します（ていうか、ここのコードはほぼすべて[GitHub][]に公開してあるので、ご自由にお読みくださいませ）が、

```liquid
{% raw %}{% auto_title ogp xml %}
{% auto_description ogp xml %}{% endraw %}
```

テンプレートにこう書いたのが

```html
{% auto_title ogp xml %}
{% auto_description ogp xml %}
```

このように変換されます。ていうか、やり始めた時にあらためて自分で書いたプラグインを見返してみたら、**すでに`auto_description_tag.rb`の方にはこれを実現するためのコードが書いてあったよ! 自分で書いてるはずなのに忘れてたよ!** という訳で、もう一方にはほぼそれをコピペしただけですね。涙

`og:image`については、各記事に独自の画像URLを指定できなければ意味がないので、YAML front matterに

```yaml
og:
  image: /images/path/to/custom-ogp-image.jpg
```

のようにパスを指定すれば、その画像のフルURLが出力されるようにしました。指定がない場合にはとりあえず[デフォルト（共通）の画像][default]URLを出力するようにしてありますが、適用されるのはトップページやアーカイブ系のページ、指定を書いてない古い記事だけになるでしょう。いや、そうなるようにがんばります。涙

`og:type`についてはトップページにだけ`website`を、それ以外は`article`を出力するだけなので簡単。あとはもうテンプレート直書きで済むものや、`_config.yml`に書いた設定値そのままか、各種変数を組み合わせて出力するものだけですね。

で、以上のコードを`ogp.html`というインクルード・ファイルにまとめて、ベースとなるレイアウト・ファイルで読み込んで完成です。だいたい半日くらいで終わりました。正直、**ここまでこの報告エントリーを書くのに費やしてる時間の方が長い**です。涙


## という訳で

簡単にいうと、**このサイト上のどのページをどこのSNSにシェアしても、いい感じに表示されるようになりましたよ**、というお知らせでした。この記事も含めまして、どんどんSNSでシェアして拡散にご協力いただけると幸いです。  
あっ、でもなるべくなら古いやつは避けてほしいです、オレの顔がそこら辺に貼られることになるので。涙


[blosxom]: https://blosxom.sourceforge.net/
[jekyll]: https://jekyllrb.com/
[twitter]: https://x.com/jforg/status/1740922529907454154
[x]: https://twitter.com/
[archives]: https://jekyll.github.io/jekyll-archives/
[github]: https://github.com/jforg/jeffreyfrancesco.org
[default]: /images/ogp_default.jpg


[^1]: まぁ今は[X][]というらしいですが、僕は [#意地でもTwitterって言い続けるマン][twitter] なので…
[^2]: Twitterがああいう残念な感じになってしまったので、その移行先を検討するためという意味もあるけど、いざ使いたくなって出遅れて登録した時にいつものアカウント名 (JForg) が取られてて使えないと非常に萎えるから…というのもある。