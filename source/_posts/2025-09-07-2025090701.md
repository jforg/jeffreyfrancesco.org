---
title: Chrome v140 に入った CSS 型付き算術 (typed arithmetic) で単位なし line-height 値の動的算出をわずか一行で書く
excerpt: Chrome v140 の calc() 関数で単位の付いた値同士を除算して単位のない数値を算出できるようになったので、その実践的なユースケースとして単位のない line-height 値を動的に算出する方法を書いてみました。
date: 2025/09/07 01:00
layout: post
categories: [weblog]
og:
  image: /images/2025/09/04/css-typed-arithmetic-post_thumbnail.webp
---

こなさんみんばんわ。
はじめて生成 AI (Grok) に OGP 画像を生成させてみたら、ものの数分で思い描いていたような画像を生成してくれて草。

そんな話はさておき、先日リリースされた Google Chrome バージョン 140 の新機能のひとつに <b lang="en">CSS typed arithmetic</b>（CSS 型付き算術[^1]）というのがあります。簡単にいうと、今までの CSS の `calc()` 関数ではできなかった単位の付いた値同士の割り算ができるようになったというもので、これにより `calc()` 関数を使って単位のない数値を算出することが可能になりました。

Safari では [v18.2 ですでに実装済み][safari]、Edge でも同じく [v140 でこの機能がサポートされております][edge][^2]が、本日はその実践的なユースケースとして「単位のない `line-height` 値を要素のフォントサイズに応じて動的に算出する」というのを Pure CSS でシンプルに書いてみたいと思います。

…と、これだけの文章ではどういうことかよく分からないかもしれませんが、実例を見ていただければどれだけ便利で、かつ直感的に短く書けるかがお分かりいただける（のではないか😅）と思いますので、よろしければご一読くださいませ。


[^1]: …と[日本語版リリースノート][chrome]では訳されています。個人的にはどちらかというと「型」より「単位」の方が適切な気もしましたが、ここは公式に従って同じ訳語をそのまま使うことにします。
[^2]: とても全部は書き切れないのでここでは省略しますが、もちろんその他の Chromium 採用ブラウザでも v140 ベースとなった時点で順次サポートが入るはずです。
[chrome]: https://developer.chrome.com/release-notes/140?hl=ja#css_typed_arithmetic
[safari]: https://developer.apple.com/documentation/safari-release-notes/safari-18_2-release-notes#CSS
[edge]: https://learn.microsoft.com/ja-jp/microsoft-edge/web-platform/release-notes/140#css-typed-arithmetic


{% include ads_inarticle.html %}

{% include page_toc.html %}


## 前提: この記事に登場するキーワード


まぁこの記事タイトルに惹かれて読みに来るような方が `calc()` や `line-height` のことを知らないとは到底思えない訳ですが、いちおう記事を読む上で出てくるキーワードについて、最低限これくらいは分かってないとチンプンカンプンかも…と思うものをリストアップして、簡単にその解説や、理解するのに役立つ 参考 URL を加えておきたいと思います。**知ってる方は[読み飛ばして本題へ](#main-topic)どうぞ**。


### `calc()` 関数

<b>`calc()`</b> は CSS 上で四則演算ができる関数です。単位が違っても足したり引いたりできて[^3]便利なのはもちろん、最近は式の中で CSS 変数（カスタム・プロパティ）や三角関数なども使えるようになってより便利になりました。よりくわしい解説やその構文サンプル、注意点などについては MDN の記事<cite>[calc() - CSS: カスケーディングスタイルシート | MDN](https://developer.mozilla.org/ja/docs/Web/CSS/calc)</cite>をご覧ください。

[^3]: そうはいっても許容されるのはデータの型が同一の単位に限られますので、（そもそもそんな計算をしたい人はいないと思いますが）`calc(100px + 0.5s)` のようなことはできません。


### `font-size` プロパティ

さすがに説明するまでもないかもしれませんが…その名のとおり、Web ページの要素が使用する文字（フォント）の大きさを指定するための CSS プロパティが `font-size` です。解説やその構文サンプル、注意点などについては同じく MDN の記事<cite>[font-size - CSS: カスケーディングスタイルシート | MDN](https://developer.mozilla.org/ja/docs/Web/CSS/font-size)</cite>をご覧ください。


### `line-height` プロパティ

文字の大きさ = 行の高さでは間が詰まって文章が読みにくいことこの上ないので、普通は文字の大きさに対して 1.5 〜 2 倍程度のサイズにされるものですが、CSS でこの行ボックスの高さを指定するのが <b>`line-height`</b> プロパティです。解説や（以下略）は MDN の記事<cite>[line-height - CSS: カスケーディングスタイルシート | MDN](https://developer.mozilla.org/ja/docs/Web/CSS/line-height)</cite>へ。


### CSS の定義におけるレディング、ハーフ・レディング

で、その行ボックスの高さと文字サイズの差はスペースとなってテキストの上下に現れる訳ですが、そのスペースの合計が CSS において<b>レディング</b> (<span lang="en">leading</span>) と呼ばれるもので、さらにそれを半分にしたものが<b>ハーフ・レディング</b> (<span lang="en">half-leading</span>) となります。このあたりは<cite>[ウェブデザインにおけるline-heightについて | Rriver](https://parashuto.com/rriver/development/line-height-in-web-design)</cite>という記事で図解入りで分かりやすく解説されておりますので、僕の文章だけでは分からなかったという方はご参考になさってください。涙


### `em` と `lh` そして `rem` と `rlh`

これらはいずれもフォントを基準にした長さの単位（`<length>` 型）です。<b>`em`</b> と <b>`lh`</b> はそれぞれその要素自身の `font-size` および `line-height` の計算値、また <b>`rem`</b> と <b>`rlh`</b> はそれぞれルート要素（`html`）における `1em` および `1lh` に相当します。`em`, `rem` にはそれ自身の `font-size` に使用される場合の例外があります。詳しくは<cite>[&lt;length&gt; - CSS: カスケーディングスタイルシート | MDN](https://developer.mozilla.org/ja/docs/Web/CSS/length)</cite>にて。


## 単位なしの `line-height` 値を `calc()` 関数で算出したい {#main-topic}


さて、ここからが本題。ちょうどこのサイトで以前から実際に採用しているタイポグラフィの調整方法がありまして、今回はそれを題材にしてみようと思います。


### ただ文字サイズ大きくしただけだと行間めっちゃ広くなる問題

このサイトはルート要素の文字サイズを 100%（ユーザーの環境にも依存するけどおおむね `16px`）、`line-height` を `2` にしていますが、各ページの冒頭にある記事タイトルの文字サイズは、スマホなどの狭い画面では本文の 2 倍、タブレットやパソコンなどの広い画面では 2.5 倍になるように設定しています。

```css
/* このサイトの CSS そのままではないけど、やってることは一緒 */
html {
  font-size: 100%;
  line-height: 2;
}
/* 記事タイトルの class */
.page_header-title {
  font-size: 200%;

  @media (width >= 48em) {
    font-size: 250%;
  }
}
```

ですが、この場合ただ単に上のコード例のように `font-size: 250%` としただけだと、見出しが長くて複数行に渡るような場合に、その行間がものすごく空いてしまいます。本文の文字サイズが `16px` だとしてその 2.5 倍、さらに `line-height` が 2 倍ですから、単純計算で `40px` のレディングです。そりゃ広いわってなります。


<p class="codepen" data-height="640" data-default-tab="css,result" data-slug-hash="zxvyyQx" data-pen-title="フォントサイズだけ拡大した h1 要素のサンプル" data-user="jforg" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/jforg/pen/zxvyyQx">
  フォントサイズだけ拡大した h1 要素のサンプル</a> by Jeffrey Francesco (<a href="https://codepen.io/jforg">@jforg</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>


これだけ広いとやはり本文の行間との差も相まってとても違和感を感じますし、単純に読みづらいというのもあります。なので、ここは `line-height` の方も調整して見出しの行間を整えたいところです。


### 文字サイズが変わっても行間は本文と変わらないようにしてみる

その調整方法のひとつとして現在このサイトで採用しているのが、**見出しの `line-height` を常にその文字サイズ + ベースとなる本文のレディング分にする**というものです。ウチを例にして具体的に説明すると、

1. 本文の `font-size` は `16px`, `line-height` はその 2 倍で `32px`
2. ベースとなる本文のレディング長は `32px - 16px` で `16px`
3. 見出しの `font-size` は `250%` なので `16px * 2.5` = `40px`
4. 見出しの `line-height` は 3. の `40px` に 2. の `16px` を加えた `56px` となる

という流れですね[^4]。そして、できればこれを他の要素に関しても自動で算出できるようにしたいところです。昔はそのようなことは CSS プリプロセッサー（Sass など）の関数を使わないとできませんでしたが、**今は Pure CSS でたった一行で実現できます**:

```css
h1 {
  line-height: calc(1em + (1rlh - 1rem));
}
```

[^4]: 実際にはこれに `line-height` をピクセル値→単位なしの値に変換する作業も入るのですが、とりあえず今は考えないことにします。


いちおう説明しておきますと、`rlh` が本文の `line-height` 計算値、`1rem` が本文の `font-size` 計算値ですから、その差 **`1rlh - 1rem` は本文のレディング部分に相当する長さ**となります。その計算結果を要素自身の文字サイズである `1em` に足せば「要素の文字サイズ + 本文のレディング」が計算されます。あとはそれを `line-height` にすればいいだけです。

👇実際に適用してみたデモです:


<p class="codepen" data-height="640" data-default-tab="css,result" data-slug-hash="YPyBbOY" data-pen-title="フォントサイズと一緒に line-height を調整した h1 要素のサンプル" data-user="jforg" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/jforg/pen/YPyBbOY">
  フォントサイズと一緒に line-height を調整した h1 要素のサンプル</a> by Jeffrey Francesco (<a href="https://codepen.io/jforg">@jforg</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>


このコードの良いところは、もちろん Pure CSS なので都度コンパイルなどをしなくていいというのもありますが、何より**メディアクエリーなどを使ってレスポンシブに文字サイズを変更する場合でも `line-height` は設定し直さなくていい**ところですね。`1em` は常にその要素自身の文字サイズを表しますから、文字サイズが変わればブラウザが再計算してくれるはずなので。

最初に挙げたこのサイトのコード例でいえば、`line-height` が必要なのは `.page_title-header` 直下のみで、`@media` ルール内には必要ありません。書かなくてもちゃんとその条件下での計算値である `56px` が適用されます。

```css
.page_header-title {
  font-size: 200%;
  line-height: calc(1em + (1rlh - 1rem));
  /* ↑これだけ書けば */
  /* @media の外側では 32px + 16px = 48px */

  @media (width >= 48em) {
    font-size: 250%;
    /* 内側では 40px + 16x = 56px になる */
  }
}
```


### この CSS コード唯一の問題点は「ピクセル値であること」

ですがこのコード、おおむね期待どおりの機能はするんですがひとつだけ問題点がありまして、それは **calc() 関数の結果としてピクセル値が算出される**というところ。特に今回のように `line-height` に対してピクセル値（に限らず単位のある `<length-percentage>` 値）が使用されると、場合によっては予期せぬ結果を引き起こすことがある…というのはよく知られているところです。


<p class="codepen" data-height="480" data-default-tab="css,result" data-slug-hash="zxveVYN" data-pen-title="`calc(1em + (1rlh - 1rem))`の結果はピクセル値になる" data-user="jforg" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/jforg/pen/zxveVYN">
  `calc(1em + (1rlh - 1rem))`の結果はピクセル値になる</a> by Jeffrey Francesco (<a href="https://codepen.io/jforg">@jforg</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>


このデモは分かりやすいようにあえて極端になるような設定にしていますが😅 要はこのように親要素の `line-height` 値（ピクセル）が子の `<strong>` 要素にそのまま継承されるため、**その文字サイズによっては文字が重なって読めなくなる**{: .sad }ということが起こる訳ですね。前提のセクションで挙げた MDN の記事でも<q cite="https://developer.mozilla.org/ja/docs/Web/CSS/line-height#line-height_%E3%81%AE%E5%80%A4%E3%81%AF%E5%8D%98%E4%BD%8D%E3%81%AA%E3%81%97%E3%81%AE%E6%95%B0%E5%80%A4%E3%81%8C%E5%A5%BD%E3%81%BE%E3%81%97%E3%81%84">[line-height の値は単位なしの数値が好ましい](https://developer.mozilla.org/ja/docs/Web/CSS/line-height#line-height_%E3%81%AE%E5%80%A4%E3%81%AF%E5%8D%98%E4%BD%8D%E3%81%AA%E3%81%97%E3%81%AE%E6%95%B0%E5%80%A4%E3%81%8C%E5%A5%BD%E3%81%BE%E3%81%97%E3%81%84)</q>とされており、これは CSS のベスト・プラクティスのひとつといってもいい内容です。


### でも今までの `calc()` 関数ではこれが限界でした…

「それやったらお前、ピクセルの絶対値から比率を示す単位なしの数値に変換したったらええんちゃうんけ!」ということで、先ほどのコードを修正してこういう計算をしたくなりませんか? 実は僕これ最初やってしまってました😅

```css
h1 {
  /* 行ボックスの高さを文字サイズで割ったら
     その比率が数値として出るはずや! */
  line-height: calc((1em + (1rlh - 1rem)) / 1em);
}
```

ですが、残念ながらこれは動作しません（でした）。なぜなら今までの `calc()` 関数では**掛け算と割り算の場合、片方の値は単位なしじゃないとダメだった**{: .sad }からです。これは [CSS Values and Units Module Level 3 の §8.1.2][level3en]（[その日本語訳][level3ja]）にて規定されており、MDN にも次のような記載があります。

> 現在の実装では、`*` および `/` 演算子では、オペランドの 1 つが単位なしである必要があります。`/` の場合、右のオペランドが単位なしでなければなりません。例えば、`font-size: calc(1.25rem / 1.25)` は有効ですが、`font-size: calc(1.25rem / 125%)` は不正なコードです。
{: cite="https://developer.mozilla.org/ja/docs/Web/CSS/calc#%E5%85%A5%E5%8A%9B%E3%81%AE%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85" title="calc() - CSS: カスケーディングスタイルシート §入力の注意事項 | MDN" }

[level3en]: https://www.w3.org/TR/2024/CRD-css-values-3-20240322/#calc-type-checking
[level3ja]: https://momdo.github.io/css3-values/#calc-type-checking

なので、今までは単位なしの `line-height` 値を自動で算出するためには、これまで同様に Sass などの関数を使うか、もしくは単位なしの値が入ったカスタム・プロパティをいくつか定義しておいて、それを使って計算するくらいしか方法はなかった訳です。

```css
:root {
  /* 基準値 */
  --base-line-height: 2;
  /* `calc(1rlh - 1rem)` に相当する部分
     ルートの文字サイズ倍率は常に基準 = 1 となるのでこれで OK */
  --base-leading-size: calc(var(--base-line-height) - 1);

  /* 要素の font-size をベースからどれだけ拡大するかを入れておく */
  --font-scale-h1-wide: 2.5;
  --font-scale-h1-narrow: 2;
}
html {
  font-size: 100%;
  line-height: var(--base-line-height);
}
.page_header-title {
  /* メディアクエリ対応ができるように独立した変数を用意 */
  --font-scale: var(--font-scale-h1-narrow);

  font-size: calc(var(--font-scale) * 100%);
  /* `calc((1em + (1rlh - 1rem)) / 1em)` に相当する部分 */
  line-height: calc((var(--font-scale) + var(--base-leading-size)) / var(--font-scale));

  @media (width >= 48em) {
    /* これだけ変更すれば `line-height` は自動で追従 */
    --font-scale: var(--font-scale-h1-wide);
  }
}
```

こうやってがんばれば実現できないこともないですが、これにさらに他の見出しレベルだとか、見出し以外の文字サイズが変わる要素が加わることを考えると、コード長くて見通しも悪くなりそう…というのは容易に想像つきますね。あと単純に面倒くさい(´･_･`)


## CSS 型付き算術 = 次期仕様に従ったアップグレード版 `calc()`


そんな `calc()` 関数における掛け算・割り算でのオペランドに対する制限が、**次の仕様である [CSS Values and Units Module Level 4][level4en] では緩められることになりました**。ﾜｰﾊﾟﾁﾊﾟﾁ
これは Level 3 と同じく [“Type Checking” のセクション][level4-10.9]（セクション番号は §10.9 に変わりますが）に Note として記載されています。以下は[日本語訳][level4ja]からの抜粋:

> 注記： この仕様の以前までのバージョンでは、［ 乗算／除算 ］がとれる引数は制限されていた — 複階的な中間結果（ `1px * 1em` の次元は <var>&lt;length&gt;</var> の 2 乗になるなど）が生産されるのを避けるため ／ 0 による除算を構文解析時に検出可能にするため。 このバージョンでは、 その制約は緩められる。
{: cite="https://triple-underscore.github.io/css-values-ja.html#calc-type-checking" title="CSS の値と単位 — CSS Values and Units Module Level 4 （日本語訳）§10.9. 型の検査法" }

[level4en]: https://www.w3.org/TR/css-values-4/
[level4-10.9]: https://www.w3.org/TR/css-values-4/#calc-type-checking
[level4ja]: https://triple-underscore.github.io/css-values-ja.html

今回 Chrome v140 に入った CSS 型付き算術 (CSS typed arithmetic) というのはつまり、**この新しい仕様に従って実装されたアップグレード版の `calc()` 関数**ということですね。冒頭にも書いたとおり Safari や Edge でも導入がされておりますので、他の Chromium ベースのブラウザも含めればかなりの環境で、次の CSS コードが動作するということになります。

```css
/* 前セクションに例示したコードはシンプルにこうできる */
html {
  font-size: 100%;
  line-height: 2;
}
/* 記事タイトルの class */
.page_header-title {
  font-size: 200%;
  line-height: calc((1em + (1rlh - 1rem)) / 2);

  @media (width >= 48em) {
    font-size: 250%;
  }
}
```

超すっきり😀

また、実際に対応ブラウザで次のデモを見ると、前のデモとは違って `<strong>` 要素内のテキストが重ならずに表示されるかと思います。これで `line-height` を計算している `calc()` 関数がちゃんと単位なしの値を算出していることも、お分かりいただけるのではないでしょうか。


<p class="codepen" data-height="480" data-default-tab="css,result" data-slug-hash="MYaLPRa" data-pen-title="`calc((1em + (1rlh - 1rem)) / 1em)`の結果は単位のない数値になる" data-user="jforg" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/jforg/pen/MYaLPRa">
  `calc((1em + (1rlh - 1rem)) / 1em)`の結果は単位のない数値になる</a> by Jeffrey Francesco (<a href="https://codepen.io/jforg">@jforg</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>


### でも実際に問題なく使えるのはまだ先のことになりそう

以上、ここまで CSS 型付き算術のお話をしてきました。個人的にはそれこそ今すぐにでも使えるとありがたい機能なんですが、残念なことに **まだ Firefox にはこの機能が入ってないですし、近々入りそうな風でもない**{: .sad }のですよね…(´･_･`)

これから実装されたとしても今年中に間に合うかといったところでしょうから、早くてもおそらく Baseline 2026 とか 2027 くらいになりそうですし、そうなると実際に問題なく使えるようになるのは 2, 3 年くらい後になるんでしょうかね? あまりその辺のことはよく分かりませんが、とりあえず「問題なく使っていいよね」と言えるようになるのはまだまだ先の話になりそうな気がします。

`@scope` の件も含めて Mozilla がんばれ。涙


## そんな訳で


今回は Google Chrome v140 の新機能である CSS typed arithmetic（CSS 型付き算術）の簡単な説明と、その実践的なユースケースとして単位なしの `line-height` 値を動的に算出する方法を、これまでの CSS だとこうするしかなかったよね…という実装例との比較を交えつつ書いてみました。

[Chrome のリリースノート][chrome]でも少し触れられていますが、この他にも例えば、いわゆる Modular Scale の *** に使えそう（←今は伏せておく、後日書くかも）とか、タイポグラフィに応用する方法はいくつか思いつきました。詳しい方ならもっと色々と便利なアイデアが出てくるのかもしれません。

リリースノートの最初の方に出してある割には地味な機能だと感じられた方が（もしかすると）いるかもしれませんが、個人的にはそんなことなくて、けっこう便利に使っていけるんじゃないかなぁと思っております。

という訳で、みなさんも何か活用法を思いついたら自分のブログでも、あるいは [Note][] でも [Zenn][] でも [Qiita][] でも何でもいいので何かに書いてストックしておくと、全主要ブラウザで問題なく使えるようになった時にきっと役に立つはずなので、どんどんアウトプットしてみてください。そしたらいいのがあった時にオレがパクれて（ry


[note]: https://note.com/
[zenn]: https://zenn.dev/
[qiita]: https://qiita.com/


<script async src="https://public.codepenassets.com/embed/index.js"></script>
